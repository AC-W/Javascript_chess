<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="description" content="Javascript Chess">
		<meta name="author" content="Ryan Wei">
		<meta name="keywords" content="chess, Projects, Ryan">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./static/css/style.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script type="text/javascript"></script>
		<title>Chess</title>
	</head>
	<body onload="reload()">
		<div style="display:none;">
			<img id="black_pawn"
				 src="./static/resources/pieces_image/black_pawn.png"
				 width="100" height="100">

			<img id="white_pawn"
				src="./static/resources/pieces_image/white_pawn.png"
				width="100" height="100">

			<img id="white_rook"
				src="./static/resources/pieces_image/white_rook.png"
				width="100" height="100">

			<img id="black_rook"
				src="./static/resources/pieces_image/black_rook.png"
				width="100" height="100">

			<img id="white_knight"
				src="./static/resources/pieces_image/white_knight.png"
				width="100" height="100">

			<img id="black_knight"
				src="./static/resources/pieces_image/black_knight.png"
				width="100" height="100">

			<img id="white_bishop"
				src="./static/resources/pieces_image/white_bishop.png"
				width="100" height="100">

			<img id="black_bishop"
				src="./static/resources/pieces_image/black_bishop.png"
				width="100" height="100">

			<img id="white_queen"
				src="./static/resources/pieces_image/white_queen.png"
				width="100" height="100">

			<img id="black_queen"
				src="./static/resources/pieces_image/black_queen.png"
				width="100" height="100">

			<img id="white_king"
				src="./static/resources/pieces_image/white_king.png"
				width="100" height="100">

			<img id="black_king"
				src="./static/resources/pieces_image/black_king.png"
				width="100" height="100">
		  </div>

		<div class="header">
			<h1>Chess</h1>
		</div>

		<div class="main_container">

			<div class="canvas_container">
				<canvas id="game_board"></canvas>
				<canvas id="game_pieces"></canvas>
				<canvas id="game_pieces_up"></canvas>
			</div>

			<div class="input_container">
				<button class="input_items" id="restart">Restart</button>
				<input class="input_items" type="text" id="secret_key" placeholder="Join ID"></input>
				<p>Type ID to Join</p>
				<div style="display: flex; flex-direction:row;" class="input_items">
					<button id="generate_key" onclick="generatekey()">Generate ID</button>
					<button style="margin-left: 1rem;" id="join_game" onclick="join_game()">Join Game</button>
				</div>
			</div>

		</div>
		<script>
			const requestURL = "https://pyhtonchessapi.herokuapp.com"
			var myId = "None"
		</script>
		<script src="./static/js/chess.js"></script>
		<script src="./static/js/main.js"></script>
		<script>
			const secret_key = document.getElementById('secret_key');

			function reload(){
				console.log('reset')
				let xhr = new XMLHttpRequest();
				formData = new FormData();
    			formData.append('gameID',secret_key.value);

				xhr.open('POST',requestURL+'/reset',true)
				xhr.onload = function () {
					var data = JSON.parse(this.response)
					if (xhr.status >= 200 && xhr.status < 400) {
						if (data.valid == 1){
							game.update(data.array)
						}
						picked_up = [null,null]
						game.draw(gp_ctx)
						game.draw(gpu_ctx,false)
					} else {
					console.log('error')
					}
				}
				xhr.send(formData)
			}
			function uid() {
				return (performance.now().toString(36)+Math.random().toString(36)).replace(/\./g,"");
			};
			function generatekey(){
				console.log("generating new ID")
				secret_key.value = uid()
			}

			function join_game(){
				myId = secret_key.value
				formData = new FormData();
    			formData.append('gameID',myId);

				let xhr = new XMLHttpRequest();
				xhr.open('POST',requestURL+'/start_game',true);
				xhr.onload = function () {
					var data = JSON.parse(this.response)
					if (xhr.status >= 200 && xhr.status < 400) {
						if (data.valid == 1){
							game.update(data.array)
						}
						picked_up = [null,null]
						game.draw(gp_ctx)
						game.draw(gpu_ctx,false)
					} else {
					console.log('error')
					}
				}
				xhr.send(formData);
			}
		</script>

	</body>

</html>